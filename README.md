# Руководство по использованию `endscaner.sh`

## Назначение

`endscaner.sh` — это простой Bash-скрипт, автоматизирующий две самые популярные операции:
1. **Проверку доступности списка сайтов** с помощью [httpx](https://github.com/projectdiscovery/httpx) и фильтрацию по HTTP-кодам.
2. **Запуск сканирования** найденных «живых» URL на уязвимости с помощью [nuclei](https://github.com/projectdiscovery/nuclei).

Все артефакты (JSON-ответы, списки живых URL, результаты nuclei и логи) автоматически сохраняются в папке:
```
reports/<ГГГГ‐ММ‐ДД_ЧЧ‐ММ‐СС>/
```

## Требования

- Linux / macOS с Bash / WSL 
- Установленные утилиты:
  - `httpx` (ProjectDiscovery CLI-версия, не Python-библиотека)  
  - `jq` (для разбора JSON)  
  - `nuclei` (CLI сканер шаблонов)  

Проверить наличие:
```bash
command -v httpx jq nuclei
```

## Установка скрипта
1. Скопируйте содержимое в файл scan.sh:
```bash
curl -o endscaner.sh https://…/endscaner.sh
```
2. Сделайте файл исполняемым:
    ```bash
    chmod +x endscaner.sh
    ```
    **Важно**: убедитесь, что файл сохранён с Unix-окончаниями (LF), иначе запускайте через
    ```bash
    bash endscaner.sh …
    ```

## Структура папки результатов

При каждом запуске скрипт создаёт каталог:
```
reports/2125-05-18_14-30-00/
```
и внутри генерирует:
- `httpx_2025-05-18_14-30-00.json` — полный JSON-отчёт httpx
- `live_sites_2025-05-18_14-30-00.txt` — перечень URL с согласованными кодами
- `nuclei_2025-05-18_14-30-00.txt` — вывод nuclei
- `scan_2025-05-18_14-30-00.log` — логи ошибок

## Основной синтаксис

```bash
./endscaner.sh [options]
```
Если не передавать ни одной опции, скрипт выполнит всё по порядку:
1. Проверит зависимости (`httpx`, `jq`, `nuclei`)
2. Выведет статус-коды (опция `--status`)
3. Соберёт JSON и отфильтрует URL (опция `--check`)
4. Запустит nuclei (`--scan`)

## Опции

| Ключ                          | Описание                                                                         |
| ----------------------------- | -------------------------------------------------------------------------------- |
| `--deps`                      | Только проверка зависимостей                                                     |
| `--status`                    | Выводит в консоль каждый URL и его HTTP-код (из `sites_to_scan.txt`)             |
| `--check`                     | `httpx … -json` + фильтрация по кодам → `live_sites_<ts>.txt`                    |
| `--scan`                      | `nuclei -l live_sites_<ts>.txt → nuclei_<ts>.txt`                                |
| `--all`                       | `--deps` + `--status` + `--check` + `--scan` (по умолчанию при отсутствии опций) |
| `--httpx "<opts>"`            | Передать доп. флаги в httpx (например: `"-timeout 5 -tls-grab"`)                 |
| `--codes "<code1> <code2> …"` | Список HTTP-кодoв для фильтрации (пример: `"200 301 302 400"`)                   |
| `-h`, `--help`                | Показать это сообщение                                                           |


## Примеры

1. Только проверка зависимостей
```bash
./endscaner.sh --deps
```
2. Только статус-коды (все)
```bash
./endscaner.sh --status
```
3. Статус-коды, фильтрация 200 и 400
```bash
./endscaner.sh --status --codes "200 400"
```
4. Полный цикл с настройкой httpx
```bash
./endscaner.sh --all \
  --httpx "-timeout 10 -tls-grab" \
  --codes "200 301"
```
5. Запуск nuclei после всех проверок
```bash
./endscaner.sh --scan
```

## Подсказка по входным данным

Список URL для сканирования указывайте в файле `sites_to_scan.txt` (по одной записи в строке):
```txt
https://example.com
http://test.local
...
```
